generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRoles {
  USER
  ADMIN
}

enum EntityTypes {
  CAMPGROUND
  USER
  EQUIPMENT
  THREAD 
}

enum NotificationTypes {
  TYPE1
  TYPE2
}

model User {
  firebaseId String   @id
  lastName   String   @default("")
  userName   String
  email      String   @unique
  role       UserRoles @default(USER) 
  address    String
  trips      Trip[]
  cart       Cart[]
  wishlist   Wishlist[]
  profile    Profile?
  chat     Chat?     @relation(fields: [chatId], references: [id])
  chatId   Int?
  threads  Thread[]
   comments Comment[]
}

model Trip {
  id       Int        @id @default(autoincrement())
  location String
  duration String
  rating   Float
  text     String
  date     DateTime
  userId   String
  user     User       @relation(fields: [userId], references: [firebaseId])
  images   Image[]
  wishlist Wishlist[]
  carts    Cart[]
}

model Image {
  id         Int        @id @default(autoincrement())
  imageId    String
  entityType EntityTypes
  entityId   String
  tripId     Int?
  trip       Trip?      @relation(fields: [tripId], references: [id])
  threadId   Int?       // Added this line
  thread     Thread?    @relation(fields: [threadId], references: [id])  // And this line
}

model Wishlist {
  userId String
  tripId Int
  user   User   @relation(fields: [userId], references: [firebaseId])
  trip   Trip   @relation(fields: [tripId], references: [id])

  @@id([userId, tripId])
}

model Cart {
  userId String
  tripId Int
  user   User   @relation(fields: [userId], references: [firebaseId])
  trip   Trip   @relation(fields: [tripId], references: [id])

  @@id([userId, tripId])
}

model Notification {
  id   Int              @id @default(autoincrement())
  type NotificationTypes
  time DateTime
}

model Profile {
  userId String @id @unique
  user   User   @relation(fields: [userId], references: [firebaseId])
}

model Chat {
  id       Int      @id @default(autoincrement())
  users    User[]  
  messages Message[]
}

model Message {
  id       Int      @id @default(autoincrement())
  content  String
  chat     Chat     @relation(fields: [chatId], references: [id])
  chatId   Int
}

model Thread {
  id         Int       @id @default(autoincrement())
  title      String
  content    String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  authorId   String
  author     User      @relation(fields: [authorId], references: [firebaseId])
  comments   Comment[]
  images     Image[]   
  imagePath String?
}



model Comment {
  id         Int       @id @default(autoincrement())
  content    String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  threadId   Int
  thread     Thread    @relation(fields: [threadId], references: [id])
  authorId   String
  author     User      @relation(fields: [authorId], references: [firebaseId])
}
